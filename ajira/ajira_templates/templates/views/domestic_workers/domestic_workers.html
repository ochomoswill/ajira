{% extends 'base.html' %}

{% load static %}
{% block title %}
Ajiriwa
{% endblock %}


{% block content %}

<ul class="nav nav-tabs" style="padding-left: 200px" id="myTab" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" id="ajiriwa" href="#home" role="tab"
           onclick="assignAjiriwaActive()" aria-controls="home">Ajiriwa</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" id="ajiriwa_profiles" href="#profile" onclick="assignProfileActive()"
           role="tab" aria-controls="profile">Profiles</a>
    </li>

</ul>

<script>

    function assignAjiriwaActive() {
        document.getElementById('ajiriwa').classList.add('active');
        document.getElementById('ajiriwa_profiles').classList.remove('active');
    }
    function assignProfileActive() {
        document.getElementById('ajiriwa_profiles').classList.add('active');
        document.getElementById('ajiriwa').classList.remove('active');
    }


    $(document).ready(function () {
        document.getElementById('searchCard').style.display = 'none';


        if (location.hash) {
            $("a[href='" + location.hash + "']").tab("show");
            setTabActive();
        }
        $(document.body).on("click", "a[data-toggle]", function (event) {
            location.hash = this.getAttribute("href");
        });
    });

    $(window).on("popstate", function () {
        var anchor = location.hash || $("a[data-toggle='tab']").first().attr("href");
        $("a[href='" + anchor + "']").tab("show");
        setTabActive();


    });

    function setTabActive()
    {
        if (location.hash == "#profile") {
            assignProfileActive();
        }
        else if (location.hash == "#home") {
            assignAjiriwaActive();
        }
    }


</script>


<!--###############################################################################################################################################################################################################-->
<!--     AJIRIWA TAB       -->
<!--###############################################################################################################################################################################################################-->
<div class="tab-content">
    <div class="tab-pane active" id="home" role="tabpanel">


        <div class="jumbotron jumbotron-fluid text-center">
            <div class="container">
                <h1 class="display-3" style="text-align: center; font-weight: 300; margin-top: 40px">Become an
                    Ajiriwa</h1>

                <h1 class="lead" style="text-align: center; font-weight: 300; margin-top: 40px">Apply to be an Ajiriwa
                    and have a profile visible to all possible employers.</h1>

            </div>
        </div>


        <div class="container">

            <div class="col-md-12" style="padding: 20px; margin-top: 60px; margin-bottom: 60px;">

                <h1 class="text-center" style="font-weight: 300">Why Ajira is right for you?</h1>

                <div class="row ajira-objectives">
                    <div class="offset-md-1 col-md-10 ajira-objectives-text">
                        <ul class="list-unstyled">
                            <li class="media">
                                <img style="width:25px; margin-top: 5px" class="d-flex mr-3"
                                     src="/ajira_static/images/workers/success%20(1).png"
                                     alt="Generic placeholder image">
                                <div class="media-body">
                                    <h3 class="mt-0 mb-1" style="font-weight: 300">Gain access to a large network of new
                                        employers. </h3>
                                </div>
                            </li>
                            <li class="media my-4">
                                <img style="width:25px; margin-top: 5px" class="d-flex mr-3"
                                     src="/ajira_static/images/workers/success%20(1).png"
                                     alt="Generic placeholder image">
                                <div class="media-body">
                                    <h3 class="mt-0 mb-1" style="font-weight: 300">Build up your professional profile
                                        through previous employer feedback and gain an online personal resume that grows with
                                        each job you do</h3>
                                </div>
                            </li>
                            <li class="media">
                                <img style="width:25px; margin-top: 5px" class="d-flex mr-3"
                                     src="/ajira_static/images/workers/success%20(1).png"
                                     alt="Generic placeholder image">
                                <div class="media-body">
                                    <h3 class="mt-0 mb-1" style="font-weight: 300">Gain access to a large number of diverse jobs posted by our large network of employers and even apply for them. </h3>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <!--<div class="col-lg-6 img-right">
                        <img class="img-fluid" src="/ajira_static/images/image_placeholder.jpg"/>
                    </div>-->
                </div>
            </div>


            <div class="col-lg-12" style="margin-bottom: 60px">
                <h1 class="text-center" style="margin-bottom: 60px; font-weight: 300">Becoming an Ajiriwa</h1>
                <div class="row ajira-objectives">
                    <div class="col-lg-6 ajira-objectives-text">
                        <h2>Create your Professional Profile</h2>
                        <p>Create your own personalized Professional Profile to promote your unique work experience,
                            skills and availability. Ajira verifies credentials to provide
                            employers with additional peace of mind when considering you for a job. The more detailed your
                            profile, the more likely employers will hire you.</p>
                        <a style="color: #2f5597; text-transform: uppercase; font-weight: 600" href="#">Start Your
                            Profile</a>
                    </div>
                    <div class="col-lg-6 img-right">
                        <img class="img-fluid" src="/ajira_static/images/workers/createAccount.png"/>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="row ajira-objectives">
                    <div class="col-lg-6 img-left">
                        <img class="img-fluid" src="/ajira_static/images/workers/browseJobs.png"/>
                    </div>
                    <div class="col-lg-6 ajira-objectives-text">
                        <h2>Browse Job Opportunities</h2>
                        <p>Browse posted jobs in your area of speciality. Ajira allows you
                            to search all current job opportunites in your area by: skills and location, schedule and pay
                            rates. Ajira also alerts you to jobs that may fit your skills and experience.</p>
                        <a style="color: #2f5597;text-transform: uppercase; font-weight: 600" href="#">Browse Jobs</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-12" style="margin-bottom: 60px">
                <div class="row ajira-objectives">
                    <div class="col-lg-6 ajira-objectives-text">
                        <h2>Communicate directly with employers</h2>
                        <p>You choose the jobs and employers you want to work with. You contract directly with employers to
                            agree on the job, rate and schedule.</p>
                        <a style="color: #2f5597;text-transform: uppercase; font-weight: 600" href="#">Learn More</a>
                    </div>
                    <div class="col-lg-6 img-right">
                        <img class="img-fluid" src="/ajira_static/images/image_placeholder.jpg"/>
                    </div>
                </div>
            </div>

            <div class="card text-center" style="margin-bottom: 60px; margin-top: 60px">
                <div class="card-block">
                    <h4 class="card-title">Become an Ajiriwa</h4>
                    <p class="card-text">To apply click on the button below and fill in the details appropriately.</p>
                    <a href="{% url 'ajiriwa_reg' %}" class="btn btn-primary" style="background-color: #2f5597;">Apply
                        to be an Ajiriwa</a>
                </div>
            </div>

        </div>
    </div>


    <!--###############################################################################################################################################################################################################-->
    <!--     PROFILES TAB       -->
    <!--###############################################################################################################################################################################################################-->
    <div class="tab-pane" id="profile" role="tabpanel">

        <div class="jumbotron jumbotron-fluid text-center">
            <div class="container">
                <h1 class="display-3" style="text-align: center; font-weight: 300; margin-top: 40px">Have a look at the
                    Ajiriwas</h1>

                <h1 class="lead" style="text-align: center; font-weight: 300; margin-top: 40px">Some of the
                    professionals who have their profiles uploaded.</h1>

            </div>
        </div>

        <div class="container">


            <div class="col-lg-12" style="">
                <div class="card" id="searchCard" style="margin-bottom: 40px; display: none;">
                    <div class="card-header">
                        <h3>Search</h3>
                    </div>


                    <div class="card-block">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-selectSkill">
                                        <img width="40px" src="{% static 'images/my_profile/072-skills-1.svg' %}"
                                             alt="Skills">
                                    </span>
                                    <select class="form-control" id="selectSkill" aria-describedby="basic-selectSkill">
                                        <option value="INIT">Select Skill</option>
                                        <option>Sewing</option>
                                        <option>Lumberjack</option>
                                        <option>House Cleaning</option>
                                        <option>Nanny</option>
                                        <option>Fumigation</option>
                                        <option>Gardening</option>
                                        <option>Cooking</option>
                                        <option>Chauffeur</option>
                                    </select>
                                </div>
                                <!--<div class="form-group">
                                    <label style="font-size: 18px" for="selectSkill">Skill:</label>
                                    <select class="form-control" id="selectSkill">
                                        <option value="INIT">Select Skill</option>
                                        <option>Sewing</option>
                                        <option>Lumberjack</option>
                                        <option>House Cleaning</option>
                                        <option>Nanny</option>
                                        <option>Fumigation</option>
                                        <option>Gardening</option>
                                        <option>Cooking</option>
                                        <option>Chauffeur</option>
                                    </select>
                                </div>-->
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-selectCounty">
                                        <img width="40px" src="{% static 'images/search/011-map.svg' %}"
                                             alt="County">
                                    </span>
                                    <select class="form-control" id="selectCounty"
                                            aria-describedby="basic-selectCounty">
                                        <option value="INIT">Select County</option>
                                        {% for county in counties %}
                                        <option value="{{county.id}}">{{county.county_name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <!--<div class="form-group">
                                    <label style="font-size: 18px" for="selectCounty">County:</label>
                                    <select class="form-control" id="selectCounty">
                                        <option value="INIT">Select County</option>
                                        {% for county in counties %}
                                        <option value="{{county.id}}">{{county.county_name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>-->
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-selectConstituency">
                                        <img width="40px" src="{% static 'images/search/011-map.svg' %}"
                                             alt="Constituency">
                                    </span>
                                    <select class="form-control" id="selectConstituency"
                                            aria-describedby="basic-selectConstituency">
                                        <option value="INIT">Select Constituency</option>

                                        {% for constituency in constituencies %}
                                        <option value="{{constituency.id}}">
                                            {{constituency.constituency_name}}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <!--<div class="form-group">
                                    <label style="font-size: 18px"
                                           for="selectConstituency">Constituency:</label>
                                    <select class="form-control" id="selectConstituency">
                                        <option value="INIT">Select Constituency</option>

                                        {% for constituency in constituencies %}
                                        <option value="{{constituency.id}}">
                                            {{constituency.constituency_name}}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>-->
                            </div>
                        </div>
                        <div class="row" style="margin-top: 20px">
                            <div class="col-md-3 pull-right">
                                <a href="#" onclick="getSearchDetails()" class="btn btn-outline-info btn-lg btn-block"
                                   style="border: 1px solid #2196f3;">Search</a>
                            </div>

                        </div>
                    </div>
                </div>

                <script>
                    //For getting CSRF token
                    function getCookie(name) {
                        var cookieValue = null;
                        if (document.cookie && document.cookie != '') {
                            var cookies = document.cookie.split(';');
                            for (var i = 0; i < cookies.length; i++) {
                                var cookie = jQuery.trim(cookies[i]);
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }

                    function post(data, url, next_url) {


                        var request = new XMLHttpRequest();

                        request.open("POST", url, true);

                        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                        // Only send the token to relative URLs i.e. locally.
                        request.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                        request.onreadystatechange = function () {
                            console.log("request.readyState = " + request.readyState + "request.status = " + request.status);
                            if (request.readyState == 4 && request.status == 200) {

                                /*var obj = JSON.parse(request.responseText);

                                 document.getElementById("message").innerHTML = "";
                                 document.getElementById("update_message").innerHTML = alert(obj.data);*/


                                console.log("posted the data");
                                //window.location = "/ajiriwa_search/#profile";
                                window.location = next_url;
                            }

                        };

                        request.send(data);
                    }


                    function getSearchDetails() {
                        var url = "/ajiriwa_search_details/";

                        /*getting the landlord name from dropdown list*/
                        var selectConstituencyObj = document.getElementById("selectConstituency");
                        var constituency = selectConstituencyObj.options[selectConstituencyObj.selectedIndex].value;


                        /*getting the landlord name from dropdown list*/
                        var selectCountyObj = document.getElementById("selectCounty");
                        var county = selectCountyObj.options[selectCountyObj.selectedIndex].value;


                        /*getting the country from dropdown list*/
                        var selectSkillObj = document.getElementById("selectSkill");
                        var skills = selectSkillObj.options[selectSkillObj.selectedIndex].text;

                        console.log(skills);
                        console.log(constituency);
                        console.log(county);

                        var data = "&skills=" + skills +
                            "&constituency=" + constituency +
                            "&county=" + county;

                        post(data, url, "/ajiriwa_search/#profile");
                    }


                    function getProfileByName() {
                        var url = "/ajiriwa_search_name/";

                        /*getting the landlord name from dropdown list*/
                        var ajiriwa_name = document.getElementById("namesearchField").value;


                        console.log(ajiriwa_name);

                        var data = "&ajiriwa_name=" + ajiriwa_name;

                        post(data, url, "/search_ajiriwa_by_name/#profile");
                    }



                </script>

                <div class="row" style="margin-bottom: 20px">
                    <div class="col-12">
                        <div class="float-right">
                            <a class="btn btn-info" style="color:white;" onclick="reloadPage()">
                                Reload
                            </a>
                            <a class="btn btn-success " style="color:white"
                               onclick="toggleVisibility(document.getElementById('searchCard'))">
                                Search for Ajiriwa
                            </a>
                            <!--<form class="form-inline">
                              <input class="form-control" type="text" placeholder="Search by Name">
                              <button class="btn btn-outline-success" type="submit">Search</button>
                            </form>-->
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-bottom: 20px">
                    <div class="col-12">
                        <div class="float-right">
                            <form class="form-inline">
                              <input class="form-control" id="namesearchField" type="text" placeholder="Search by Name">
                              <button class="btn btn-outline-success" onclick="getProfileByName()">Search</button>
                            </form>
                        </div>
                    </div>
                </div>

                <script>

                    var toggleVisibility = function (element) {
                        if (element.style.display == 'block') {
                            element.style.display = 'none';
                        } else {
                            element.style.display = 'block';
                        }
                    };

                    function reloadPage() {
                        window.location.href = "/ajiriwa/#profile"
                    }
                </script>




                <div class="row">
                    {% for employee in employees %}
                    <div class="col-lg-3" style="margin-bottom: 60px">
                        <div class="card">
                            <img class="card-img-top img-thumbnail" width="500px" src="{{ employee.worker_avatar.url }}"
                                 alt="Card image cap">
                            <div class="card-block">
                                <h4 class="card-title">{{employee.worker_name}}</h4>
                                <!--<p class="card-text"><span class="profile_text_titles">Skills:</span>
                                    {{employee.skills}}</p>-->
                                <p class="card-text"><span class="profile_text_titles"><img width="32px"
                                                                                            style="margin-right: 10px"
                                                                                            src="{% static 'images/my_profile/072-skills-1.svg' %}"
                                                                                            alt="Skills"></span>
                                    {{employee.skills }}</p>
                                <p class="card-text"><span
                                        class="profile_text_titles"><img width="32px" style="margin-right: 10px"
                                                                         src="{% static 'images/my_profile/map-location.svg' %}"
                                                                         alt="Location"></span>
                                    {{employee.constituency_id }}, {{employee.county_id }}
                                </p>
                                <!--<p class="card-text"><span class="profile_text_titles">Location:</span> Nairobi, Kenya.
                                </p>-->
                                <!--<p class="card-text"><span class="profile_text_titles">Services:</span> Plumbing and
                                    Chief Chef</p>-->
                            </div>
                            <div class="card-footer">
                                <a style="background-color: #2f5597;" class="btn btn-primary btn-lg"
                                   href="{{employee.get_absolute_url}}" role="button">See Full Profile</a>
                            </div>
                        </div>
                    </div>

                    {% empty %}
                    <div class="col-lg-12" style="margin-bottom: 60px">
                        <div class="card text-center">
                            <div class="card-header">
                                <h4 class="card-title text-danger">
                                    0 Ajiriwas Found
                                </h4>
                                <hr>
                            </div>

                            <div class="card-block">
                                <img class="img-fluid center" width="350px" style="margin-top: 60px;margin-bottom: 60px" src="{% static 'images/search/worker.svg' %}"
                                 alt="No Ajiriwa Image">
                                <h4 class="card-title text-info" style="padding: 60px">Sorry, there are no Ajiriwas matching your search criteria. Kindly click on the <strong>RELOAD</strong> button to view the present Ajiriwas.</h4>


                                <!--<p class="card-text"><span class="profile_text_titles">Location:</span> Nairobi, Kenya.
                                </p>-->
                                <!--<p class="card-text"><span class="profile_text_titles">Services:</span> Plumbing and
                                    Chief Chef</p>-->
                            </div>

                        </div>
                    </div>

                    {% endfor %}

                </div>


                <div class="row" style="margin-bottom: 60px; margin-top: 60px">
                    <div class="offset-lg-4 col-lg-4 text-center">
                        {% include 'paginator.html' with page=employees %}
                        <!--<a href="#" style="color: #2f5597;text-transform: uppercase; font-weight: 500; font-size: 21px">Browse More Ajiriwas</a>-->
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>
{% endblock %}